<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Connection (current_ocluster.Current_ocluster.Connection)</title><link rel="stylesheet" href="../../../_odoc_support/odoc.css"/><meta charset="utf-8"/><meta name="generator" content="odoc 2.2.0"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../../_odoc_support/highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body class="odoc"><nav class="odoc-nav"><a href="../index.html">Up</a> â€“ <a href="../../index.html">current_ocluster</a> &#x00BB; <a href="../index.html">Current_ocluster</a> &#x00BB; Connection</nav><header class="odoc-preamble"><h1>Module <code><span>Current_ocluster.Connection</span></code></h1><p>A connection to the OCluster scheduler. Provides automatic reconnection on failure, queuing with rate limiting, metrics reporting, etc. This can be passed to <code>Current_ocluster.v</code> for simple cases, or it can used directly to implement custom pipeline steps if that isn't flexible enough.</p></header><div class="odoc-content"><div class="odoc-spec"><div class="spec type anchored" id="type-t"><a href="#type-t" class="anchor"></a><code><span><span class="keyword">type</span> t</span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-create"><a href="#val-create" class="anchor"></a><code><span><span class="keyword">val</span> create : 
  <span>?max_pipeline:int <span class="arrow">&#45;&gt;</span></span>
  <span><span><a href="../../../ocluster-api/Cluster_api/Raw/Client/Submission/index.html#type-t">Cluster_api.Raw.Client.Submission.t</a> <span class="xref-unresolved">Capnp_rpc_lwt</span>.Sturdy_ref.t</span> <span class="arrow">&#45;&gt;</span></span>
  <a href="#type-t">t</a></span></code></div><div class="spec-doc"><p><code>create submission_service</code> is a connection that submits jobs to <code>submission_service</code>.</p><ul class="at-tags"><li class="parameter"><span class="at-tag">parameter</span> <span class="value">max_pipeline</span> <p>: how many items to queue up at the scheduler per (pool, urgency).</p></li></ul></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-pool"><a href="#val-pool" class="anchor"></a><code><span><span class="keyword">val</span> pool : 
  <span>job:<span class="xref-unresolved">Current</span>.Job.t <span class="arrow">&#45;&gt;</span></span>
  <span>pool:string <span class="arrow">&#45;&gt;</span></span>
  <span>action:<a href="../../../ocluster-api/Cluster_api/Submission/index.html#type-send_action">Cluster_api.Submission.send_action</a> <span class="arrow">&#45;&gt;</span></span>
  <span>cache_hint:string <span class="arrow">&#45;&gt;</span></span>
  <span>?src:<span>(string * <span>string list</span>)</span> <span class="arrow">&#45;&gt;</span></span>
  <span>?secrets:<span><span>(string * string)</span> list</span> <span class="arrow">&#45;&gt;</span></span>
  <span>?urgent:<span>(<span><span>[ `High <span>| `Low</span> ]</span> <span class="arrow">&#45;&gt;</span></span> bool)</span> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span><a href="../../../ocluster-api/Cluster_api/Raw/Client/Job/index.html#type-t">Cluster_api.Raw.Client.Job.t</a> <span class="xref-unresolved">Capnp_rpc_lwt</span>.Capability.t</span> <span class="xref-unresolved">Current</span>.Pool.t</span></span></code></div><div class="spec-doc"><p><code>pool ~job ~pool ~action ~cache_hint t</code> is a resource pool, suitable for passing to <code>Current.Job.start_with</code>. Submits <code>action</code> to the pool named <code>pool</code> at <code>t</code>. If <code>t</code> is disconnected, it will keep trying to reconnect until it succeeds.</p><ul class="at-tags"><li class="parameter"><span class="at-tag">parameter</span> <span class="value">job</span> <p>Used to write log messages.</p></li></ul><ul class="at-tags"><li class="parameter"><span class="at-tag">parameter</span> <span class="value">cache_hint</span> <p>Hint to the scheduler (similar jobs should be assigned to the same machine, if possible).</p></li></ul><ul class="at-tags"><li class="parameter"><span class="at-tag">parameter</span> <span class="value">urgent</span> <p>Used to calculate the job's urgency, possibly using the OCurrent priority. The default is to mark high priority jobs as urgent.</p></li></ul></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-run_job"><a href="#val-run_job" class="anchor"></a><code><span><span class="keyword">val</span> run_job : 
  <span>job:<span class="xref-unresolved">Current</span>.Job.t <span class="arrow">&#45;&gt;</span></span>
  <span><span><a href="../../../ocluster-api/Cluster_api/Raw/Client/Job/index.html#type-t">Cluster_api.Raw.Client.Job.t</a> <span class="xref-unresolved">Capnp_rpc_lwt</span>.Capability.t</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span>(string, <span>[&gt; <span>`Msg of string</span> ]</span>)</span> <span class="xref-unresolved">Stdlib</span>.result</span> <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p><code>run_job ~job ocluster_job</code> tails the log of <code>ocluster_job</code> to <code>job</code> and then returns the job's result.</p></div></div></div></body></html>
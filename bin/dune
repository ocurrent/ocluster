(rule
 (targets
  provider.h
  provider.rc
  MSG00409.bin)
 (deps provider.mc)
 (action (run %{ocaml-config:target}-windmc %{deps}))
 (enabled_if (= %{os_type} Win32)))

(rule
 (target provider.o)
 (deps provider.rc)
 (action (run %{ocaml-config:target}-windres %{deps} %{target}))
 (enabled_if (= %{os_type} Win32)))

(rule
 (target dllprovider.dll)
 (deps provider.o)
 (action (run %{cc} -shared %{deps} -o %{target}))
 (enabled_if (= %{os_type} Win32)))

(install
 (files dllprovider.dll)
 (section lib)
 (package ocluster)
 (enabled_if (= %{os_type} Win32)))

(executables
 (public_names ocluster-scheduler ocluster-client ocluster-worker ocluster-admin)
 (package ocluster)
 (names scheduler client worker admin)
 (libraries dune-build-info ocluster-api logs.cli logs.fmt fmt.cli fmt.tty capnp-rpc-unix cluster_scheduler cluster_worker prometheus-app.unix db win-eventlog
  (select winsvc_wrapper.ml from
   (winsvc -> winsvc_wrapper.winsvc.ml)
   (       -> winsvc_wrapper..ml))))


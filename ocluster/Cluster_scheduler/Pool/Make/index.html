<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Make (ocluster.Cluster_scheduler.Pool.Make)</title><link rel="stylesheet" href="../../../../_odoc_support/odoc.css"/><meta charset="utf-8"/><meta name="generator" content="odoc 2.2.0"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../../../_odoc_support/highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body class="odoc"><nav class="odoc-nav"><a href="../index.html">Up</a> â€“ <a href="../../../index.html">ocluster</a> &#x00BB; <a href="../../index.html">Cluster_scheduler</a> &#x00BB; <a href="../index.html">Pool</a> &#x00BB; Make</nav><header class="odoc-preamble"><h1>Module <code><span>Pool.Make</span></code></h1></header><nav class="odoc-toc"><ul><li><a href="#parameters">Parameters</a></li><li><a href="#signature">Signature</a></li></ul></nav><div class="odoc-content"><h2 id="parameters"><a href="#parameters" class="anchor"></a>Parameters</h2><div class="odoc-spec"><div class="spec parameter anchored" id="argument-1-Item"><a href="#argument-1-Item" class="anchor"></a><code><span><span class="keyword">module</span> </span><span><a href="argument-1-Item/index.html">Item</a></span><span> : <a href="../../S/module-type-ITEM/index.html">S.ITEM</a></span></code></div></div><div class="odoc-spec"><div class="spec parameter anchored" id="argument-2-_"><a href="#argument-2-_" class="anchor"></a><code><span><span class="keyword">module</span> </span><span><a href="argument-2-_/index.html">_</a></span><span> : <a href="../../S/module-type-TIME/index.html">S.TIME</a></span></code></div></div><h2 id="signature"><a href="#signature" class="anchor"></a>Signature</h2><div class="odoc-spec"><div class="spec type anchored" id="type-t"><a href="#type-t" class="anchor"></a><code><span><span class="keyword">type</span> t</span></code></div><div class="spec-doc"><p>A pool of workers and queued jobs.</p></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-ticket"><a href="#type-ticket" class="anchor"></a><code><span><span class="keyword">type</span> ticket</span></code></div><div class="spec-doc"><p>A queued item.</p></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-worker"><a href="#type-worker" class="anchor"></a><code><span><span class="keyword">type</span> worker</span></code></div><div class="spec-doc"><p>A connected worker.</p></div></div><div class="odoc-spec"><div class="spec module anchored" id="module-Worker_map"><a href="#module-Worker_map" class="anchor"></a><code><span><span class="keyword">module</span> Worker_map</span><span> : <span class="xref-unresolved">Stdlib</span>.Map.S <span class="keyword">with</span> <span><span class="keyword">type</span> <span class="xref-unresolved">key</span> = <span class="xref-unresolved">string</span></span></span></code></div></div><div class="odoc-spec"><div class="spec module anchored" id="module-Client"><a href="#module-Client" class="anchor"></a><code><span><span class="keyword">module</span> <a href="Client/index.html">Client</a></span><span> : <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-create"><a href="#val-create" class="anchor"></a><code><span><span class="keyword">val</span> create : <span>name:string <span class="arrow">&#45;&gt;</span></span> <span>db:<a href="../Dao/index.html#type-t">Dao.t</a> <span class="arrow">&#45;&gt;</span></span> <a href="#type-t">t</a></span></code></div><div class="spec-doc"><p><code>create ~name ~db</code> is a pool that reports metrics tagged with <code>name</code> and stores cache information in <code>db</code>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-register"><a href="#val-register" class="anchor"></a><code><span><span class="keyword">val</span> register : 
  <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span>
  <span>name:string <span class="arrow">&#45;&gt;</span></span>
  <span>capacity:int <span class="arrow">&#45;&gt;</span></span>
  <span><span>(<a href="#type-worker">worker</a>, <span>[&gt; `Name_taken ]</span>)</span> <span class="xref-unresolved">Stdlib</span>.result</span></span></code></div><div class="spec-doc"><p><code>register t ~name ~capacity</code> returns a queue for worker <code>name</code>.</p><ul class="at-tags"><li class="parameter"><span class="at-tag">parameter</span> <span class="value">capacity</span> <p>Worker's capacity (max number of parallel jobs).</p></li></ul></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-client"><a href="#val-client" class="anchor"></a><code><span><span class="keyword">val</span> client : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span>client_id:string <span class="arrow">&#45;&gt;</span></span> <a href="Client/index.html#type-t">Client.t</a></span></code></div><div class="spec-doc"><p><code>client t ~client_id</code> is a client value, which can be used to submit jobs. These jobs will be scheduled alongside the jobs of other clients, so that one client does not starve the others.</p><ul class="at-tags"><li class="parameter"><span class="at-tag">parameter</span> <span class="value">[client_id]</span> <p>Used for logging and reporting.</p></li></ul></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-remove_client"><a href="#val-remove_client" class="anchor"></a><code><span><span class="keyword">val</span> remove_client : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span>client_id:string <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p><code>remove_client t ~client_id</code> deletes all information about <code>client_id</code>, if any. Call this on all pools when deleting a user.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-pop"><a href="#val-pop" class="anchor"></a><code><span><span class="keyword">val</span> pop : <span><a href="#type-worker">worker</a> <span class="arrow">&#45;&gt;</span></span> <span><span>(<a href="argument-1-Item/index.html#type-t">Item.t</a>, <span>[&gt; `Finished ]</span>)</span> <span class="xref-unresolved">Lwt_result</span>.t</span></span></code></div><div class="spec-doc"><p><code>pop worker</code> gets the next item for <code>worker</code>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-job_finished"><a href="#val-job_finished" class="anchor"></a><code><span><span class="keyword">val</span> job_finished : <span><a href="#type-worker">worker</a> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p><code>job_finished worker</code> is called when <code>worker</code> completes a job.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-running_jobs"><a href="#val-running_jobs" class="anchor"></a><code><span><span class="keyword">val</span> running_jobs : <span>?prev:int <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-worker">worker</a> <span class="arrow">&#45;&gt;</span></span> <span>int <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p><code>running_jobs worker</code> returns the number of jobs running on <code>worker</code>.</p><ul class="at-tags"><li class="parameter"><span class="at-tag">parameter</span> <span class="value">prev</span> <p>Wait until the number is different to <code>prev</code> before returning.</p></li></ul></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-set_active"><a href="#val-set_active" class="anchor"></a><code><span><span class="keyword">val</span> set_active : <span>reason:<a href="../Inactive_reasons/index.html#type-t">Inactive_reasons.t</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-worker">worker</a> <span class="arrow">&#45;&gt;</span></span> <span>bool <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p><code>set_active ~reason worker active</code> sets the worker's active flag for <code>reason</code>. A worker is active if it has no reasons to be inactive. When active, items can be added from the main queue. When inactive, any entries on the queue are pushed back to the main queue, and the queue stops accepting new items.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-inactive_reasons"><a href="#val-inactive_reasons" class="anchor"></a><code><span><span class="keyword">val</span> inactive_reasons : <span><a href="#type-worker">worker</a> <span class="arrow">&#45;&gt;</span></span> <a href="../Inactive_reasons/index.html#type-t">Inactive_reasons.t</a></span></code></div><div class="spec-doc"><p><code>inactive_reasons worker</code> is the set of reasons why <code>worker</code>'s queue is inactive, if any.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-is_active"><a href="#val-is_active" class="anchor"></a><code><span><span class="keyword">val</span> is_active : <span><a href="#type-worker">worker</a> <span class="arrow">&#45;&gt;</span></span> bool</span></code></div><div class="spec-doc"><p><code>is_active worker</code> is <code>inactive_reasons worker = empty</code>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-shutdown"><a href="#val-shutdown" class="anchor"></a><code><span><span class="keyword">val</span> shutdown : <span><a href="#type-worker">worker</a> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p><code>shutdown worker</code> marks <code>worker</code> as shutting down. The worker is set to inactive, and cannot become active again.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-connected_workers"><a href="#val-connected_workers" class="anchor"></a><code><span><span class="keyword">val</span> connected_workers : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-worker">worker</a> <span class="xref-unresolved">Worker_map</span>.t</span></span></code></div><div class="spec-doc"><p><code>connected_workers t</code> is the set of workers currently connected, whether active or not, indexed by name.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-known_workers"><a href="#val-known_workers" class="anchor"></a><code><span><span class="keyword">val</span> known_workers : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="../../../../ocluster-api/Cluster_api/Pool_admin/index.html#type-worker_info">Cluster_api.Pool_admin.worker_info</a> list</span></span></code></div><div class="spec-doc"><p><code>known_workers t</code> lists all workers known to the pool, whether connected or not.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-with_worker"><a href="#val-with_worker" class="anchor"></a><code><span><span class="keyword">val</span> with_worker : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span>string <span class="arrow">&#45;&gt;</span></span> <span><span>(<span><a href="#type-worker">worker</a> <span class="arrow">&#45;&gt;</span></span> <span class="type-var">'a</span>)</span> <span class="arrow">&#45;&gt;</span></span> <span class="type-var">'a</span></span></code></div><div class="spec-doc"><p><code>with_worker t name f</code> is <code>f worker</code> if <code>worker</code> is in <code>connected_workers</code>. If not, it temporarily registers it, runs <code>f</code>, and then releases it.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-worker_known"><a href="#val-worker_known" class="anchor"></a><code><span><span class="keyword">val</span> worker_known : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span>string <span class="arrow">&#45;&gt;</span></span> bool</span></code></div><div class="spec-doc"><p><code>worker_known t name</code> is <code>true</code> when worker <code>name</code> has previously registered with this pool, whether currently connected or not.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-release"><a href="#val-release" class="anchor"></a><code><span><span class="keyword">val</span> release : <span><a href="#type-worker">worker</a> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p><code>release worker</code> marks <code>worker</code> as disconnected. <code>worker</code> cannot be used again after this (use <code>register</code> to get a new one).</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-forget_worker"><a href="#val-forget_worker" class="anchor"></a><code><span><span class="keyword">val</span> forget_worker : 
  <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span>
  <span>string <span class="arrow">&#45;&gt;</span></span>
  <span><span>(unit, <span>[ `Unknown_worker <span>| `Still_connected</span> ]</span>)</span> <span class="xref-unresolved">Stdlib</span>.result</span></span></code></div><div class="spec-doc"><p><code>forget_worker t name</code> removes <code>name</code> from the set of known workers.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-show"><a href="#val-show" class="anchor"></a><code><span><span class="keyword">val</span> show : <span><a href="#type-t">t</a> <span class="xref-unresolved">Fmt</span>.t</span></span></code></div><div class="spec-doc"><p><code>show</code> shows the state of the system, including registered workers and queued jobs.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-dump"><a href="#val-dump" class="anchor"></a><code><span><span class="keyword">val</span> dump : <span><a href="#type-t">t</a> <span class="xref-unresolved">Fmt</span>.t</span></span></code></div><div class="spec-doc"><p><code>dump</code> is similar to <code>show</code>, but also dumps the contents of the database. It is probably only useful for unit-tests.</p></div></div></div></body></html>